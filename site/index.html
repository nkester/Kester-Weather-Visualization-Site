<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Grant and Neil Kester">
<meta name="dcterms.date" content="2024-03-23">

<title>Kester Weather Station</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="weatherStationWebsite_files/libs/clipboard/clipboard.min.js"></script>
<script src="weatherStationWebsite_files/libs/quarto-html/quarto.js"></script>
<script src="weatherStationWebsite_files/libs/quarto-html/popper.min.js"></script>
<script src="weatherStationWebsite_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="weatherStationWebsite_files/libs/quarto-html/anchor.min.js"></script>
<link href="weatherStationWebsite_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="weatherStationWebsite_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="weatherStationWebsite_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="weatherStationWebsite_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="weatherStationWebsite_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script type="module" src="weatherStationWebsite_files/libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="weatherStationWebsite_files/libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">

<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Kester Weather Station</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button" data-quarto-source-url="https://github.com/nkester/Kester-Weather-Visualization-Site">View Source</a></li></ul></div></div>
<p class="subtitle lead">Pulling Live Data</p>
</div>



<div class="quarto-title-meta column-page">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Grant and Neil Kester </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 23, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>version: 2.0.0: New Charts that actively pull data from the project’s Google Cloud Functions.<br>
version: 1.0.0: See the original version here in <a href="https://github.com/nkester/Kester-Weather-Visualization-Site/tree/v-1.1.0">GitHub</a> and the <a href="./version1.html">website</a></p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This page is the result of a project my son and I started in the summer of 2023 to collect and display measurements from the environment near our home. We broke this project into two components which are both accessible at their public GitHub locations. They are: 1) Setting up, configuring, storing, and making accessible data from the <a href="https://github.com/nkester/Kester-Weather-Station/blob/main/README.md">Kester Weather Station</a> and 2) Displaying the data through the <a href="https://github.com/nkester/Kester-Weather-Visualization-Site/blob/main/readme.md">Kester Weather Visualization Site</a>.</p>
</section>
<section id="background" class="level1">
<h1>Background</h1>
<p>The sensor producing this data is located in the Veneto Region of Northern Italy. It takes measurements every 15 minutes, stores the data in our Raspberry Pi 4 which pushes it to the Google Cloud Platform project we developed for this. The charts are rudimentary now but will develop as we learn more JavaScript.</p>
</section>
<section id="using-the-website" class="level1">
<h1>Using the Website</h1>
<p>Think about these steps when using this website:</p>
<ul>
<li>Step 1) Select the amount of data to see. All options start with the latest observation and go back in time.</li>
<li>Step 2) Click the button “Get Data!” It will take a second to return the data so continue to the next step.
<ul>
<li>To limit cost, the data service in Google Cloud Platform waits for a request to start running rather than run all the time.<br>
</li>
</ul></li>
<li>Step 3) Select the measure you want to see.<br>
</li>
<li>Step 4) Select the level of aggregation you want. Depending on the measure, this either gives you the rolling sum for that time period (e.g.&nbsp;Rain Depth) or the average measure for that time period (e.g.&nbsp;Air Temperature).<br>
</li>
<li>Step 5) Checking the “Fancy Chart” option shows my initial attempts to use JavaScript to animate the line draw. Otherwise we use Observable Plot to draw the charts.</li>
</ul>
<blockquote class="blockquote">
<p>You can see the charted data in table form in the “Table” tab.</p>
</blockquote>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="cell panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<details class="code-fold hidden">
<summary>Show the code</summary>
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="52" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 51;"><span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>viewof measure_scale <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>([</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="st">"Select One"</span><span class="op">,</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="st">"Seven days"</span><span class="op">,</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="st">"Fourteen days"</span><span class="op">,</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="st">"Sixty days"</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>]<span class="op">,</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>{<span class="dt">label</span><span class="op">:</span> <span class="st">"Select a time scale"</span>})<span class="op">;</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@mbostock/wait-until-button</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>viewof action_sendquery <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;form&gt;</span><span class="sc">${</span><span class="bu">Object</span><span class="op">.</span><span class="fu">assign</span>(<span class="fu">html</span><span class="vs">`&lt;button type=button&gt;Get Data!`</span><span class="op">,</span> {<span class="dt">onclick</span><span class="op">:</span> <span class="bu">event</span> <span class="kw">=&gt;</span> <span class="bu">event</span><span class="op">.</span><span class="at">currentTarget</span><span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> {<span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span>}))})<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>viewof measure_type <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>([</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="st">"Air Temperature"</span><span class="op">,</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="st">"Air Humidity"</span><span class="op">,</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="st">"Barometric Pressure"</span><span class="op">,</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="st">"Light Intensity"</span><span class="op">,</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="st">"Rain Intensity"</span><span class="op">,</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="st">"Rain Depth"</span><span class="op">,</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="st">"UV Index"</span><span class="op">,</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="st">"Wind"</span>]<span class="op">,</span> </span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>{<span class="dt">label</span><span class="op">:</span> <span class="st">"Select a measure"</span>})<span class="op">;</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>viewof measure_aggregation <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>([</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  <span class="st">"None"</span><span class="op">,</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  <span class="st">"12 Hours"</span><span class="op">,</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1 Day"</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>]<span class="op">,</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>{<span class="dt">label</span><span class="op">:</span> <span class="st">"Select the level of aggregation:"</span>})<span class="op">;</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>viewof fancy <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">checkbox</span>([<span class="st">"Yes"</span>]<span class="op">,</span>{<span class="dt">label</span><span class="op">:</span> <span class="st">"Try the fancy chart?"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Plot</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Table</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2" data-startfrom="95" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 94;"><span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a><span class="co">// Decide which chart to draw based on input. There are two graph types, a standard simple continuous line plot and a polar plot of wind speed and direction. Also provide an option to try the fancy D3 plot</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>chart <span class="op">=</span> {</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>  replay<span class="op">;</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(measure_type <span class="op">==</span> <span class="st">"Wind"</span>){</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">wind_graph</span>(plotData)</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(fancy<span class="op">.</span><span class="fu">includes</span>(<span class="st">"Yes"</span>)){</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">drawchart</span>(plotData)</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">simple_graph</span>(plotData<span class="op">,</span> measure_type<span class="op">,</span> measure_unit)</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3" data-startfrom="123" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 122;"><span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>viewof replay <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">"Replay"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Data Table of plotted data:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4" data-startfrom="133" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 132;"><span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(plotData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
<p>All data returned by the cloud service:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5" data-startfrom="139" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 138;"><span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">table</span>(measures)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<section id="appendix" class="level2">
<h2 class="anchored" data-anchor-id="appendix">Appendix</h2>
<p><a href="https://www.about.nkester.com">Personal Website</a></p>
<p>Find the source code on GitHub at <a href="https://github.com/nkester/Kester-Weather-Visualization-Site">Kester Weather Visualization Site</a></p>
<p>Reference for a vector graph for wind speed and direction https://observablehq.com/<span class="citation" data-cites="d3/vector-field">@d3/vector-field</span></p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6" data-startfrom="156" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 155;"><span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { aq<span class="op">,</span> op } <span class="im">from</span> <span class="st">'@uwdata/arquero'</span></span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span>)</span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a>parser <span class="op">=</span> d3<span class="op">.</span><span class="fu">timeParse</span>(<span class="st">"%Y-%m-%d %H:%M:%S%Z"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7" data-startfrom="161" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 160;"><span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a><span class="co">// Return the graphed measure's unit based on the user's selection </span></span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a>measure_unit <span class="op">=</span> {</span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(measure_type <span class="op">===</span> <span class="st">"Rain Depth"</span>){</span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"mm"</span></span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(measure_type <span class="op">===</span> <span class="st">"Air Temperature"</span>){</span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"C"</span></span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(measure_type <span class="op">===</span> <span class="st">"Air Humidity"</span>){</span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"%RH"</span></span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(measure_type <span class="op">===</span> <span class="st">"Barometric Pressure"</span>){</span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Pa"</span></span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(measure_type <span class="op">===</span> <span class="st">"Light Intensity"</span>){</span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Lux"</span></span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(measure_type <span class="op">===</span> <span class="st">"Rain Intensity"</span>){</span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"mm/hr"</span></span>
<span id="cb7-176"><a href="#cb7-176" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(measure_type <span class="op">===</span> <span class="st">"UV Index"</span>){</span>
<span id="cb7-177"><a href="#cb7-177" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Unitless"</span></span>
<span id="cb7-178"><a href="#cb7-178" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(measure_type <span class="op">===</span> <span class="st">"Wind"</span>){</span>
<span id="cb7-179"><a href="#cb7-179" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"m/s"</span></span>
<span id="cb7-180"><a href="#cb7-180" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb7-181"><a href="#cb7-181" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Unknown"</span></span>
<span id="cb7-182"><a href="#cb7-182" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-183"><a href="#cb7-183" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8" data-startfrom="187" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 186;"><span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a><span class="co">// Arquero is an ojs package for data manipulation similar to dplyr. I import it</span></span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a><span class="co">//  above as well in the `imports` chunk. I use arquero (`aq`) to convert the </span></span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a><span class="co">//  data returned by the cloud function from a string to a datetime object.</span></span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a><span class="co">//  I've defined the date parser with `D3`, another `ojs` package. An example</span></span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a><span class="co">//  of that is here: https://stackoverflow.com/questions/76499928/passing-dates-from-r-chunk-to-ojs-chunk-using-ojs-define-in-quarto  </span></span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a><span class="co">//  </span></span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a><span class="co">// https://quarto.org/docs/interactive/ojs/examples/arquero.html</span></span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a> measures <span class="op">=</span> {</span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a> action_sendquery<span class="op">;</span></span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (measure_scale <span class="op">===</span> <span class="st">"Seven days"</span>){</span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(<span class="cf">await</span> d3<span class="op">.</span><span class="fu">json</span>(<span class="st">"https://us-east1-weather-station-ef6ca.cloudfunctions.net/https_measure_7day_asis"</span>))</span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (measure_scale <span class="op">===</span> <span class="st">"Fourteen days"</span>){</span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(<span class="cf">await</span> d3<span class="op">.</span><span class="fu">json</span>(<span class="st">"https://us-east1-weather-station-ef6ca.cloudfunctions.net/https_measure_14day_asis"</span>))</span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (measure_scale <span class="op">===</span> <span class="st">"Sixty days"</span>){</span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(<span class="cf">await</span> d3<span class="op">.</span><span class="fu">json</span>(<span class="st">"https://us-east1-weather-station-ef6ca.cloudfunctions.net/https_measure_60day_asis"</span>))</span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>{</span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(<span class="st">'[{"local_time":"1000-02-02 11:11:11","type": "test","measurementValue":"49"}]'</span>))</span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9" data-startfrom="213" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 212;"><span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a><span class="co">// Take the full dataset and filter out to only the measures the user selects.</span></span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@uwdata/an-illustrated-guide-to-arquero-verbs#filter</span></span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a><span class="co">// this should move up to the previous block but will stay here until the chart</span></span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a><span class="co">//  is figured out.</span></span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@uwdata/introducing-arquero</span></span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a>filteredData <span class="op">=</span> {</span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(measure_type <span class="op">===</span> <span class="st">"Wind"</span>){</span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">filter_wind</span>(measures)<span class="op">;</span></span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(measure_type <span class="op">===</span> <span class="st">"Rain Depth"</span>){</span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">filter_calculate_raindepth</span>(measures)</span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(measure_type <span class="op">===</span> <span class="st">"Rain Intensity"</span>){</span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">filter_general</span>(measures<span class="op">,</span> <span class="st">"Rain Gauge"</span>)</span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">filter_general</span>(measures<span class="op">,</span> measure_type)       </span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10" data-startfrom="241" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 240;"><span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a>plotData <span class="op">=</span> {</span>
<span id="cb10-242"><a href="#cb10-242" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(measure_aggregation <span class="op">===</span> <span class="st">"None"</span>){</span>
<span id="cb10-243"><a href="#cb10-243" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-244"><a href="#cb10-244" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> filteredData</span>
<span id="cb10-245"><a href="#cb10-245" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-246"><a href="#cb10-246" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(measure_aggregation <span class="op">===</span> <span class="st">"1 Day"</span>){</span>
<span id="cb10-247"><a href="#cb10-247" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-248"><a href="#cb10-248" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">aggregate_data</span>(filteredData<span class="op">,</span>measure_type<span class="op">,</span><span class="dv">1</span>)</span>
<span id="cb10-249"><a href="#cb10-249" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-250"><a href="#cb10-250" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(measure_aggregation <span class="op">===</span> <span class="st">"12 Hours"</span>){</span>
<span id="cb10-251"><a href="#cb10-251" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-252"><a href="#cb10-252" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">aggregate_data</span>(filteredData<span class="op">,</span>measure_type<span class="op">,</span><span class="fl">0.5</span>)</span>
<span id="cb10-253"><a href="#cb10-253" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-254"><a href="#cb10-254" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-255"><a href="#cb10-255" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
</div>
<section id="functions" class="level3">
<h3 class="anchored" data-anchor-id="functions">Functions</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11" data-startfrom="261" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 260;"><span id="cb11-261"><a href="#cb11-261" aria-hidden="true" tabindex="-1"></a><span class="co">// If the user wants an aggregation of a measure where summation is appropriate (rain depth), complete that aggregation on the filtered data.</span></span>
<span id="cb11-262"><a href="#cb11-262" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">aggregate_data</span>(dat<span class="op">,</span>measure<span class="op">,</span>days){ </span>
<span id="cb11-263"><a href="#cb11-263" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb11-264"><a href="#cb11-264" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(measure <span class="op">===</span> <span class="st">'Rain Depth'</span>){</span>
<span id="cb11-265"><a href="#cb11-265" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> dat</span>
<span id="cb11-266"><a href="#cb11-266" aria-hidden="true" tabindex="-1"></a>             <span class="op">.</span><span class="fu">derive</span>({ <span class="st">'measurementValue'</span><span class="op">:</span> aq<span class="op">.</span><span class="fu">rolling</span>(d <span class="kw">=&gt;</span> aq<span class="op">.</span><span class="at">op</span><span class="op">.</span><span class="fu">sum</span>(d<span class="op">.</span><span class="at">measurementValue</span>)<span class="op">,</span> [<span class="op">-</span><span class="dv">24</span> <span class="op">*</span> days<span class="op">,</span> <span class="dv">0</span>]) })</span>
<span id="cb11-267"><a href="#cb11-267" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-268"><a href="#cb11-268" aria-hidden="true" tabindex="-1"></a>           }<span class="cf">else</span>{</span>
<span id="cb11-269"><a href="#cb11-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-270"><a href="#cb11-270" aria-hidden="true" tabindex="-1"></a>              <span class="cf">return</span> dat</span>
<span id="cb11-271"><a href="#cb11-271" aria-hidden="true" tabindex="-1"></a>                      <span class="op">.</span><span class="fu">derive</span>({ <span class="st">'measurementValue'</span><span class="op">:</span> aq<span class="op">.</span><span class="fu">rolling</span>(d <span class="kw">=&gt;</span> aq<span class="op">.</span><span class="at">op</span><span class="op">.</span><span class="fu">average</span>(d<span class="op">.</span><span class="at">measurementValue</span>)<span class="op">,</span> [<span class="op">-</span><span class="dv">24</span> <span class="op">*</span> days<span class="op">,</span> <span class="dv">0</span>]) })</span>
<span id="cb11-272"><a href="#cb11-272" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-273"><a href="#cb11-273" aria-hidden="true" tabindex="-1"></a>           }</span>
<span id="cb11-274"><a href="#cb11-274" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-275"><a href="#cb11-275" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12" data-startfrom="280" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 279;"><span id="cb12-280"><a href="#cb12-280" aria-hidden="true" tabindex="-1"></a><span class="co">// Low function</span></span>
<span id="cb12-281"><a href="#cb12-281" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">filter_general</span>(dat<span class="op">,</span> measure){</span>
<span id="cb12-282"><a href="#cb12-282" aria-hidden="true" tabindex="-1"></a><span class="co">// This is just the generic filter function based on the provided measure_type</span></span>
<span id="cb12-283"><a href="#cb12-283" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> aq<span class="op">.</span><span class="fu">from</span>(dat)</span>
<span id="cb12-284"><a href="#cb12-284" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">derive</span>({ <span class="dt">time</span><span class="op">:</span> aq<span class="op">.</span><span class="fu">escape</span>(d <span class="kw">=&gt;</span> <span class="fu">parser</span>(d<span class="op">.</span><span class="at">local_time</span>)) })</span>
<span id="cb12-285"><a href="#cb12-285" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">params</span>({</span>
<span id="cb12-286"><a href="#cb12-286" aria-hidden="true" tabindex="-1"></a>          <span class="dt">m</span><span class="op">:</span> measure</span>
<span id="cb12-287"><a href="#cb12-287" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb12-288"><a href="#cb12-288" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">filter</span>((d<span class="op">,</span>p) <span class="kw">=&gt;</span> aq<span class="op">.</span><span class="at">op</span><span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">type</span><span class="op">,</span> p<span class="op">.</span><span class="at">m</span>))</span>
<span id="cb12-289"><a href="#cb12-289" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">orderby</span>( <span class="st">'time'</span>)</span>
<span id="cb12-290"><a href="#cb12-290" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-291"><a href="#cb12-291" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13" data-startfrom="295" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 294;"><span id="cb13-295"><a href="#cb13-295" aria-hidden="true" tabindex="-1"></a><span class="co">// Mid function</span></span>
<span id="cb13-296"><a href="#cb13-296" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">filter_calculate_raindepth</span>(dat){</span>
<span id="cb13-297"><a href="#cb13-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-298"><a href="#cb13-298" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">filter_general</span>(dat<span class="op">,</span><span class="st">"Rain Gauge"</span>)</span>
<span id="cb13-299"><a href="#cb13-299" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span><span class="fu">derive</span>({ <span class="st">'measurementValue'</span><span class="op">:</span> (d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">measurementValue</span> <span class="op">*</span> <span class="fl">0.25</span>)}) <span class="co">// each measurement is taken 15 min appart. The measure unit is mm/hr so we convert to mm by dividing 15/60 (15 min / measure * 1 hr / 60 min) = 0.25 hr / measure. Then multiply by the measure to get the total depth (x mm/hr * 0.25 hr/measure = x*0.25 mm / measure)</span></span>
<span id="cb13-300"><a href="#cb13-300" aria-hidden="true" tabindex="-1"></a>             <span class="op">.</span><span class="fu">orderby</span>(<span class="st">'time'</span>)</span>
<span id="cb13-301"><a href="#cb13-301" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-302"><a href="#cb13-302" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14" data-startfrom="308" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 307;"><span id="cb14-308"><a href="#cb14-308" aria-hidden="true" tabindex="-1"></a><span class="co">// Low Function</span></span>
<span id="cb14-309"><a href="#cb14-309" aria-hidden="true" tabindex="-1"></a><span class="co">// This does not re-use the general "filter_general" function because it requires two filter elements. </span></span>
<span id="cb14-310"><a href="#cb14-310" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">filter_wind</span>(dat){</span>
<span id="cb14-311"><a href="#cb14-311" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-312"><a href="#cb14-312" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> aq<span class="op">.</span><span class="fu">from</span>(dat) <span class="co">// Start with the `measures` table</span></span>
<span id="cb14-313"><a href="#cb14-313" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">derive</span>({ <span class="dt">time</span><span class="op">:</span> aq<span class="op">.</span><span class="fu">escape</span>(d <span class="kw">=&gt;</span> <span class="fu">parser</span>(d<span class="op">.</span><span class="at">local_time</span>)) })  <span class="co">// Change the time string to a time object based on the provided format</span></span>
<span id="cb14-314"><a href="#cb14-314" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">params</span>({ <span class="co">// name column parameters to be used in subsequent steps.</span></span>
<span id="cb14-315"><a href="#cb14-315" aria-hidden="true" tabindex="-1"></a>        <span class="dt">m</span><span class="op">:</span> <span class="st">"Wind Direction Sensor"</span><span class="op">,</span></span>
<span id="cb14-316"><a href="#cb14-316" aria-hidden="true" tabindex="-1"></a>        <span class="dt">n</span><span class="op">:</span> <span class="st">"Wind Speed"</span></span>
<span id="cb14-317"><a href="#cb14-317" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb14-318"><a href="#cb14-318" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">filter</span>((d<span class="op">,</span>p) <span class="kw">=&gt;</span> aq<span class="op">.</span><span class="at">op</span><span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">type</span><span class="op">,</span> p<span class="op">.</span><span class="at">m</span>) <span class="op">||</span> aq<span class="op">.</span><span class="at">op</span><span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">type</span><span class="op">,</span> p<span class="op">.</span><span class="at">n</span>)) <span class="co">// Filter the data passed (`d`) based on the type column matching the `Wind Direction Sensor` OR the `Wind Speed`.</span></span>
<span id="cb14-319"><a href="#cb14-319" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">orderby</span>( <span class="st">'time'</span>)</span>
<span id="cb14-320"><a href="#cb14-320" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">groupby</span>(<span class="st">'time'</span>)</span>
<span id="cb14-321"><a href="#cb14-321" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">pivot</span>(<span class="st">'type'</span><span class="op">,</span><span class="st">'measurementValue'</span>) <span class="co">// Expand the unique observations in the `measurementValue` column into their own columns, spreading the data from long to wide.</span></span>
<span id="cb14-322"><a href="#cb14-322" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">rename</span>({ <span class="st">'Wind Direction Sensor'</span><span class="op">:</span> <span class="st">'direction'</span><span class="op">,</span> <span class="st">'Wind Speed'</span><span class="op">:</span> <span class="st">'speed'</span>}) <span class="co">// Simplify the column naming</span></span>
<span id="cb14-323"><a href="#cb14-323" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">join_full</span>(aq<span class="op">.</span><span class="fu">table</span>({ <span class="co">// Because not all 360 degrees will have observations, I create an array of 0 - 360 and join the original to it, filling all missing elements with a 0.</span></span>
<span id="cb14-324"><a href="#cb14-324" aria-hidden="true" tabindex="-1"></a>          <span class="dt">direction</span><span class="op">:</span> <span class="bu">Array</span>(<span class="dv">361</span>)</span>
<span id="cb14-325"><a href="#cb14-325" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">fill</span>()</span>
<span id="cb14-326"><a href="#cb14-326" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">map</span>((element<span class="op">,</span> index) <span class="kw">=&gt;</span> index)<span class="op">,</span></span>
<span id="cb14-327"><a href="#cb14-327" aria-hidden="true" tabindex="-1"></a>                <span class="dt">speed</span><span class="op">:</span> <span class="bu">Array</span>(<span class="dv">361</span>)</span>
<span id="cb14-328"><a href="#cb14-328" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">fill</span>(<span class="dv">0</span>)}))</span>
<span id="cb14-329"><a href="#cb14-329" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">groupby</span>(<span class="st">'direction'</span>)</span>
<span id="cb14-330"><a href="#cb14-330" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">rollup</span>({ <span class="co">// By direction (degree), calculate the average, minimum, and maxiumum speed.</span></span>
<span id="cb14-331"><a href="#cb14-331" aria-hidden="true" tabindex="-1"></a>          <span class="dt">avg</span><span class="op">:</span> d <span class="kw">=&gt;</span> aq<span class="op">.</span><span class="at">op</span><span class="op">.</span><span class="fu">average</span>(d<span class="op">.</span><span class="at">speed</span>)<span class="op">,</span> </span>
<span id="cb14-332"><a href="#cb14-332" aria-hidden="true" tabindex="-1"></a>          <span class="dt">min</span><span class="op">:</span> d <span class="kw">=&gt;</span> aq<span class="op">.</span><span class="at">op</span><span class="op">.</span><span class="fu">min</span>(d<span class="op">.</span><span class="at">speed</span>)<span class="op">,</span> </span>
<span id="cb14-333"><a href="#cb14-333" aria-hidden="true" tabindex="-1"></a>          <span class="dt">max</span><span class="op">:</span> d <span class="kw">=&gt;</span> aq<span class="op">.</span><span class="at">op</span><span class="op">.</span><span class="fu">max</span>(d<span class="op">.</span><span class="at">speed</span>)})</span>
<span id="cb14-334"><a href="#cb14-334" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">orderby</span>(<span class="st">'direction'</span>)</span>
<span id="cb14-335"><a href="#cb14-335" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-336"><a href="#cb14-336" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15" data-startfrom="341" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 340;"><span id="cb15-341"><a href="#cb15-341" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@d3/radial-area-chart/2?intent=fork</span></span>
<span id="cb15-342"><a href="#cb15-342" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">wind_graph</span>(dat){</span>
<span id="cb15-343"><a href="#cb15-343" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">928</span><span class="op">;</span></span>
<span id="cb15-344"><a href="#cb15-344" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> width<span class="op">;</span></span>
<span id="cb15-345"><a href="#cb15-345" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb15-346"><a href="#cb15-346" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> innerRadius <span class="op">=</span> width <span class="op">/</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb15-347"><a href="#cb15-347" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> outerRadius <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> margin<span class="op">;</span></span>
<span id="cb15-348"><a href="#cb15-348" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-349"><a href="#cb15-349" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb15-350"><a href="#cb15-350" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([d3<span class="op">.</span><span class="fu">min</span>(dat<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">direction</span>)<span class="op">,</span>d3<span class="op">.</span><span class="fu">max</span>(dat<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">direction</span>)])</span>
<span id="cb15-351"><a href="#cb15-351" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>])<span class="op">;</span> <span class="co">//[d3.min(dat, d =&gt; d.direction),d3.max(dat, d =&gt; d.direction)]);</span></span>
<span id="cb15-352"><a href="#cb15-352" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-353"><a href="#cb15-353" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleRadial</span>()</span>
<span id="cb15-354"><a href="#cb15-354" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([d3<span class="op">.</span><span class="fu">min</span>(dat<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">min</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">max</span>(dat<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">max</span>)])</span>
<span id="cb15-355"><a href="#cb15-355" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([innerRadius<span class="op">,</span> outerRadius])<span class="op">;</span></span>
<span id="cb15-356"><a href="#cb15-356" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-357"><a href="#cb15-357" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> line <span class="op">=</span> d3<span class="op">.</span><span class="fu">lineRadial</span>()</span>
<span id="cb15-358"><a href="#cb15-358" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveLinearClosed</span>)</span>
<span id="cb15-359"><a href="#cb15-359" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">angle</span>(d <span class="kw">=&gt;</span> <span class="fu">x</span>(d<span class="op">.</span><span class="at">direction</span>))<span class="op">;</span></span>
<span id="cb15-360"><a href="#cb15-360" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-361"><a href="#cb15-361" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> area <span class="op">=</span> d3<span class="op">.</span><span class="fu">areaRadial</span>()</span>
<span id="cb15-362"><a href="#cb15-362" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveLinearClosed</span>)</span>
<span id="cb15-363"><a href="#cb15-363" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">angle</span>(d <span class="kw">=&gt;</span> <span class="fu">x</span>(d<span class="op">.</span><span class="at">direction</span>))<span class="op">;</span></span>
<span id="cb15-364"><a href="#cb15-364" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-365"><a href="#cb15-365" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb15-366"><a href="#cb15-366" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb15-367"><a href="#cb15-367" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb15-368"><a href="#cb15-368" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="op">-</span>width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="op">-</span>height <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> width<span class="op">,</span> height])</span>
<span id="cb15-369"><a href="#cb15-369" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"width: 100%; height: auto; font: 10px sans-serif;"</span>)</span>
<span id="cb15-370"><a href="#cb15-370" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-linejoin"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb15-371"><a href="#cb15-371" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-linecap"</span><span class="op">,</span> <span class="st">"round"</span>)<span class="op">;</span></span>
<span id="cb15-372"><a href="#cb15-372" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-373"><a href="#cb15-373" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb15-374"><a href="#cb15-374" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"lightsteelblue"</span>)</span>
<span id="cb15-375"><a href="#cb15-375" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> <span class="fl">0.3</span>)</span>
<span id="cb15-376"><a href="#cb15-376" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> area</span>
<span id="cb15-377"><a href="#cb15-377" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">innerRadius</span>(d <span class="kw">=&gt;</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">min</span>))</span>
<span id="cb15-378"><a href="#cb15-378" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">outerRadius</span>(d <span class="kw">=&gt;</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">max</span>))</span>
<span id="cb15-379"><a href="#cb15-379" aria-hidden="true" tabindex="-1"></a>            (dat))<span class="op">;</span></span>
<span id="cb15-380"><a href="#cb15-380" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-381"><a href="#cb15-381" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb15-382"><a href="#cb15-382" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb15-383"><a href="#cb15-383" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"steelblue"</span>)</span>
<span id="cb15-384"><a href="#cb15-384" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">1.5</span>)</span>
<span id="cb15-385"><a href="#cb15-385" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> line</span>
<span id="cb15-386"><a href="#cb15-386" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">radius</span>(d <span class="kw">=&gt;</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">avg</span>))</span>
<span id="cb15-387"><a href="#cb15-387" aria-hidden="true" tabindex="-1"></a>          (dat))<span class="op">;</span></span>
<span id="cb15-388"><a href="#cb15-388" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb15-389"><a href="#cb15-389" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-390"><a href="#cb15-390" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>()</span>
<span id="cb15-391"><a href="#cb15-391" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(x<span class="op">.</span><span class="fu">ticks</span>())</span>
<span id="cb15-392"><a href="#cb15-392" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">join</span>(<span class="st">"g"</span>)</span>
<span id="cb15-393"><a href="#cb15-393" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">each</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">id</span> <span class="op">==</span> DOM<span class="op">.</span><span class="fu">uid</span>(<span class="st">"degree"</span>))</span>
<span id="cb15-394"><a href="#cb15-394" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb15-395"><a href="#cb15-395" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#000"</span>)</span>
<span id="cb15-396"><a href="#cb15-396" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.2</span>)</span>
<span id="cb15-397"><a href="#cb15-397" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`</span></span>
<span id="cb15-398"><a href="#cb15-398" aria-hidden="true" tabindex="-1"></a><span class="vs">              M</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">pointRadial</span>(<span class="fu">x</span>(d)<span class="op">,</span> innerRadius)<span class="sc">}</span></span>
<span id="cb15-399"><a href="#cb15-399" aria-hidden="true" tabindex="-1"></a><span class="vs">              L</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">pointRadial</span>(<span class="fu">x</span>(d)<span class="op">,</span> outerRadius)<span class="sc">}</span></span>
<span id="cb15-400"><a href="#cb15-400" aria-hidden="true" tabindex="-1"></a><span class="vs">              `</span>))</span>
<span id="cb15-401"><a href="#cb15-401" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-402"><a href="#cb15-402" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb15-403"><a href="#cb15-403" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb15-404"><a href="#cb15-404" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>()</span>
<span id="cb15-405"><a href="#cb15-405" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(y<span class="op">.</span><span class="fu">ticks</span>()<span class="op">.</span><span class="fu">reverse</span>())</span>
<span id="cb15-406"><a href="#cb15-406" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"g"</span>)</span>
<span id="cb15-407"><a href="#cb15-407" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb15-408"><a href="#cb15-408" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb15-409"><a href="#cb15-409" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"currentColor"</span>)</span>
<span id="cb15-410"><a href="#cb15-410" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.2</span>)</span>
<span id="cb15-411"><a href="#cb15-411" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> y))</span>
<span id="cb15-412"><a href="#cb15-412" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb15-413"><a href="#cb15-413" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="op">-</span><span class="fu">y</span>(d))</span>
<span id="cb15-414"><a href="#cb15-414" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">"0.35em"</span>)</span>
<span id="cb15-415"><a href="#cb15-415" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#fff"</span>)</span>
<span id="cb15-416"><a href="#cb15-416" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb15-417"><a href="#cb15-417" aria-hidden="true" tabindex="-1"></a>         <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"currentColor"</span>)</span>
<span id="cb15-418"><a href="#cb15-418" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"paint-order"</span><span class="op">,</span> <span class="st">"stroke"</span>)</span>
<span id="cb15-419"><a href="#cb15-419" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">text</span>((x<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>x<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}${</span>i <span class="op">?</span> <span class="st">""</span><span class="op">:</span> <span class="st">" m/s"</span><span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb15-420"><a href="#cb15-420" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">clone</span>(<span class="kw">true</span>)</span>
<span id="cb15-421"><a href="#cb15-421" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">y</span>(d)))<span class="op">;</span></span>
<span id="cb15-422"><a href="#cb15-422" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-423"><a href="#cb15-423" aria-hidden="true" tabindex="-1"></a> <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb15-424"><a href="#cb15-424" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb16" data-startfrom="429" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 428;"><span id="cb16-429"><a href="#cb16-429" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">simple_graph</span>(dat<span class="op">,</span>measure<span class="op">,</span>measure_unit){</span>
<span id="cb16-430"><a href="#cb16-430" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-431"><a href="#cb16-431" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb16-432"><a href="#cb16-432" aria-hidden="true" tabindex="-1"></a>         <span class="dt">title</span><span class="op">:</span> measure <span class="op">+</span> <span class="st">" Measurement Over Time"</span><span class="op">,</span></span>
<span id="cb16-433"><a href="#cb16-433" aria-hidden="true" tabindex="-1"></a>         <span class="dt">marginTop</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb16-434"><a href="#cb16-434" aria-hidden="true" tabindex="-1"></a>         <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb16-435"><a href="#cb16-435" aria-hidden="true" tabindex="-1"></a>         <span class="dt">marginBottom</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb16-436"><a href="#cb16-436" aria-hidden="true" tabindex="-1"></a>         <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb16-437"><a href="#cb16-437" aria-hidden="true" tabindex="-1"></a>         <span class="dt">y</span><span class="op">:</span> {<span class="dt">label</span><span class="op">:</span> measure_unit}<span class="op">,</span></span>
<span id="cb16-438"><a href="#cb16-438" aria-hidden="true" tabindex="-1"></a>         <span class="dt">x</span><span class="op">:</span> {<span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb16-439"><a href="#cb16-439" aria-hidden="true" tabindex="-1"></a>            <span class="dt">label</span><span class="op">:</span> <span class="st">"Date"</span>}<span class="op">,</span></span>
<span id="cb16-440"><a href="#cb16-440" aria-hidden="true" tabindex="-1"></a>         <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb16-441"><a href="#cb16-441" aria-hidden="true" tabindex="-1"></a>           Plot<span class="op">.</span><span class="fu">lineY</span>(dat<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"measurementValue"</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"blue"</span><span class="op">,</span> <span class="dt">clip</span><span class="op">:</span> <span class="st">"frame"</span><span class="op">,</span><span class="dt">tip</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">,</span></span>
<span id="cb16-442"><a href="#cb16-442" aria-hidden="true" tabindex="-1"></a>           Plot<span class="op">.</span><span class="fu">areaY</span>(dat<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"measurementValue"</span><span class="op">,</span> <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.2</span>})<span class="op">,</span></span>
<span id="cb16-443"><a href="#cb16-443" aria-hidden="true" tabindex="-1"></a>           Plot<span class="op">.</span><span class="fu">crosshair</span>(dat<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="st">"time"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"measurementValue"</span>})<span class="op">,</span></span>
<span id="cb16-444"><a href="#cb16-444" aria-hidden="true" tabindex="-1"></a>           Plot<span class="op">.</span><span class="fu">frame</span>()</span>
<span id="cb16-445"><a href="#cb16-445" aria-hidden="true" tabindex="-1"></a>         ]</span>
<span id="cb16-446"><a href="#cb16-446" aria-hidden="true" tabindex="-1"></a>       })</span>
<span id="cb16-447"><a href="#cb16-447" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-448"><a href="#cb16-448" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17" data-startfrom="453" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 452;"><span id="cb17-453"><a href="#cb17-453" aria-hidden="true" tabindex="-1"></a>length <span class="op">=</span> (path) <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg:path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> path)<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">getTotalLength</span>()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18" data-startfrom="457" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 456;"><span id="cb18-457"><a href="#cb18-457" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@d3/connected-scatterplot/2?intent=fork</span></span>
<span id="cb18-458"><a href="#cb18-458" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb18-459"><a href="#cb18-459" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">drawchart</span>(dat<span class="op">,</span> dat2){</span>
<span id="cb18-460"><a href="#cb18-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-461"><a href="#cb18-461" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">928</span><span class="op">;</span></span>
<span id="cb18-462"><a href="#cb18-462" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> <span class="dv">720</span><span class="op">;</span></span>
<span id="cb18-463"><a href="#cb18-463" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> marginTop <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb18-464"><a href="#cb18-464" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> marginRight <span class="op">=</span> <span class="dv">30</span><span class="op">;</span></span>
<span id="cb18-465"><a href="#cb18-465" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> marginBottom <span class="op">=</span> <span class="dv">30</span><span class="op">;</span></span>
<span id="cb18-466"><a href="#cb18-466" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> marginLeft <span class="op">=</span> <span class="dv">40</span><span class="op">;</span></span>
<span id="cb18-467"><a href="#cb18-467" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-468"><a href="#cb18-468" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Declare the positional encodings.</span></span>
<span id="cb18-469"><a href="#cb18-469" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleTime</span>()</span>
<span id="cb18-470"><a href="#cb18-470" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">domain</span>(d3<span class="op">.</span><span class="fu">extent</span>(dat<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">time</span>))</span>
<span id="cb18-471"><a href="#cb18-471" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">range</span>([marginLeft<span class="op">,</span> width <span class="op">-</span> marginRight])<span class="op">;</span></span>
<span id="cb18-472"><a href="#cb18-472" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-473"><a href="#cb18-473" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb18-474"><a href="#cb18-474" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">domain</span>(d3<span class="op">.</span><span class="fu">extent</span>(dat<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">measurementValue</span>))<span class="op">.</span><span class="fu">nice</span>()</span>
<span id="cb18-475"><a href="#cb18-475" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">range</span>([height <span class="op">-</span> marginBottom<span class="op">,</span> marginTop])<span class="op">;</span></span>
<span id="cb18-476"><a href="#cb18-476" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-477"><a href="#cb18-477" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> line <span class="op">=</span> d3<span class="op">.</span><span class="fu">line</span>()</span>
<span id="cb18-478"><a href="#cb18-478" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveCatmullRom</span>)</span>
<span id="cb18-479"><a href="#cb18-479" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">x</span>(d <span class="kw">=&gt;</span> <span class="fu">x</span>(d<span class="op">.</span><span class="at">time</span>))</span>
<span id="cb18-480"><a href="#cb18-480" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">y</span>(d <span class="kw">=&gt;</span> <span class="fu">y</span>(d<span class="op">.</span><span class="at">measurementValue</span>))<span class="op">;</span></span>
<span id="cb18-481"><a href="#cb18-481" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-482"><a href="#cb18-482" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb18-483"><a href="#cb18-483" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb18-484"><a href="#cb18-484" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb18-485"><a href="#cb18-485" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height])</span>
<span id="cb18-486"><a href="#cb18-486" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto;"</span>)<span class="op">;</span></span>
<span id="cb18-487"><a href="#cb18-487" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-488"><a href="#cb18-488" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> l <span class="op">=</span> <span class="fu">length</span>(<span class="fu">line</span>(dat))<span class="op">;</span></span>
<span id="cb18-489"><a href="#cb18-489" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-490"><a href="#cb18-490" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb18-491"><a href="#cb18-491" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0,</span><span class="sc">${</span>height <span class="op">-</span> marginBottom<span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb18-492"><a href="#cb18-492" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisBottom</span>(x)<span class="op">.</span><span class="fu">ticks</span>(d3<span class="op">.</span><span class="at">timeDay</span>))</span>
<span id="cb18-493"><a href="#cb18-493" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb18-494"><a href="#cb18-494" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">clone</span>()</span>
<span id="cb18-495"><a href="#cb18-495" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> <span class="op">-</span>height)</span>
<span id="cb18-496"><a href="#cb18-496" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.1</span>))</span>
<span id="cb18-497"><a href="#cb18-497" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb18-498"><a href="#cb18-498" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> width <span class="op">-</span> <span class="dv">4</span>)</span>
<span id="cb18-499"><a href="#cb18-499" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="op">-</span><span class="dv">4</span>)</span>
<span id="cb18-500"><a href="#cb18-500" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb18-501"><a href="#cb18-501" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"end"</span>)</span>
<span id="cb18-502"><a href="#cb18-502" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"currentColor"</span>)</span>
<span id="cb18-503"><a href="#cb18-503" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">text</span>(<span class="st">"Date"</span>))<span class="op">;</span></span>
<span id="cb18-504"><a href="#cb18-504" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb18-505"><a href="#cb18-505" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb18-506"><a href="#cb18-506" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>marginLeft<span class="sc">}</span><span class="vs">,0)`</span>)</span>
<span id="cb18-507"><a href="#cb18-507" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">axisLeft</span>(y)<span class="op">.</span><span class="fu">ticks</span>(<span class="kw">null</span><span class="op">,</span> <span class="st">".2f"</span>))</span>
<span id="cb18-508"><a href="#cb18-508" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb18-509"><a href="#cb18-509" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">clone</span>()</span>
<span id="cb18-510"><a href="#cb18-510" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="op">-</span>width)</span>
<span id="cb18-511"><a href="#cb18-511" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-opacity"</span><span class="op">,</span> <span class="fl">0.1</span>))</span>
<span id="cb18-512"><a href="#cb18-512" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">call</span>(g <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb18-513"><a href="#cb18-513" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb18-514"><a href="#cb18-514" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> height <span class="op">-</span> <span class="dv">4</span>)</span>
<span id="cb18-515"><a href="#cb18-515" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"start"</span>)</span>
<span id="cb18-516"><a href="#cb18-516" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb18-517"><a href="#cb18-517" aria-hidden="true" tabindex="-1"></a>          <span class="op">.</span><span class="fu">text</span>(<span class="st">"Measure"</span>))<span class="op">;</span></span>
<span id="cb18-518"><a href="#cb18-518" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb18-519"><a href="#cb18-519" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb18-520"><a href="#cb18-520" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">datum</span>(dat)</span>
<span id="cb18-521"><a href="#cb18-521" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb18-522"><a href="#cb18-522" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"blue"</span>)</span>
<span id="cb18-523"><a href="#cb18-523" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">2.5</span>)</span>
<span id="cb18-524"><a href="#cb18-524" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-linejoin"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb18-525"><a href="#cb18-525" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-linecap"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb18-526"><a href="#cb18-526" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="vs">`0,</span><span class="sc">${</span>l<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb18-527"><a href="#cb18-527" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> line)</span>
<span id="cb18-528"><a href="#cb18-528" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb18-529"><a href="#cb18-529" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">duration</span>(<span class="dv">5000</span>)</span>
<span id="cb18-530"><a href="#cb18-530" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">ease</span>(d3<span class="op">.</span><span class="at">easeLinear</span>)</span>
<span id="cb18-531"><a href="#cb18-531" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>l<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>l<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb18-532"><a href="#cb18-532" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-533"><a href="#cb18-533" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="kw">typeof</span> dat2 <span class="op">!==</span> <span class="st">'undefined'</span>){</span>
<span id="cb18-534"><a href="#cb18-534" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-535"><a href="#cb18-535" aria-hidden="true" tabindex="-1"></a>         svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb18-536"><a href="#cb18-536" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span><span class="fu">datum</span>(dat2)</span>
<span id="cb18-537"><a href="#cb18-537" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb18-538"><a href="#cb18-538" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"red"</span>)</span>
<span id="cb18-539"><a href="#cb18-539" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">2.5</span>)</span>
<span id="cb18-540"><a href="#cb18-540" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-linejoin"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb18-541"><a href="#cb18-541" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-linecap"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb18-542"><a href="#cb18-542" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="vs">`0,</span><span class="sc">${</span>l<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb18-543"><a href="#cb18-543" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> line)</span>
<span id="cb18-544"><a href="#cb18-544" aria-hidden="true" tabindex="-1"></a>         <span class="op">.</span><span class="fu">transition</span>()</span>
<span id="cb18-545"><a href="#cb18-545" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span><span class="fu">duration</span>(<span class="dv">5000</span>)</span>
<span id="cb18-546"><a href="#cb18-546" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span><span class="fu">ease</span>(d3<span class="op">.</span><span class="at">easeLinear</span>)</span>
<span id="cb18-547"><a href="#cb18-547" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>l<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>l<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb18-548"><a href="#cb18-548" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb18-549"><a href="#cb18-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-550"><a href="#cb18-550" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb18-551"><a href="#cb18-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-552"><a href="#cb18-552" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-18" data-nodetype="declaration">

</div>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ilxudmlld29mIG1lYXN1cmVfc2NhbGUgPSBJbnB1dHMuc2VsZWN0KFtcblwiU2VsZWN0IE9uZVwiLFxuXCJTZXZlbiBkYXlzXCIsXG5cIkZvdXJ0ZWVuIGRheXNcIixcblwiU2l4dHkgZGF5c1wiXG5dLFxue2xhYmVsOiBcIlNlbGVjdCBhIHRpbWUgc2NhbGVcIn0pO1xuXG4vLyBodHRwczovL29ic2VydmFibGVocS5jb20vQG1ib3N0b2NrL3dhaXQtdW50aWwtYnV0dG9uXG52aWV3b2YgYWN0aW9uX3NlbmRxdWVyeSA9IGh0bWxgPGZvcm0+JHtPYmplY3QuYXNzaWduKGh0bWxgPGJ1dHRvbiB0eXBlPWJ1dHRvbj5HZXQgRGF0YSFgLCB7b25jbGljazogZXZlbnQgPT4gZXZlbnQuY3VycmVudFRhcmdldC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChcImlucHV0XCIsIHtidWJibGVzOiB0cnVlfSkpfSl9YFxuXG52aWV3b2YgbWVhc3VyZV90eXBlID0gSW5wdXRzLnNlbGVjdChbXG5cIkFpciBUZW1wZXJhdHVyZVwiLFxuXCJBaXIgSHVtaWRpdHlcIixcblwiQmFyb21ldHJpYyBQcmVzc3VyZVwiLFxuXCJMaWdodCBJbnRlbnNpdHlcIixcblwiUmFpbiBJbnRlbnNpdHlcIixcblwiUmFpbiBEZXB0aFwiLFxuXCJVViBJbmRleFwiLFxuXCJXaW5kXCJdLCBcbntsYWJlbDogXCJTZWxlY3QgYSBtZWFzdXJlXCJ9KTtcblxudmlld29mIG1lYXN1cmVfYWdncmVnYXRpb24gPSBJbnB1dHMuc2VsZWN0KFtcbiAgXCJOb25lXCIsXG4gIFwiMTIgSG91cnNcIixcbiAgXCIxIERheVwiXG5dLFxue2xhYmVsOiBcIlNlbGVjdCB0aGUgbGV2ZWwgb2YgYWdncmVnYXRpb246XCJ9KTtcblxudmlld29mIGZhbmN5ID0gSW5wdXRzLmNoZWNrYm94KFtcIlllc1wiXSx7bGFiZWw6IFwiVHJ5IHRoZSBmYW5jeSBjaGFydD9cIn0pXG5cbi8vdmlld29mIG9yaWdpbmFsX2RhdGEgPSBJbnB1dHMuY2hlY2tib3goW1wiWWVzXCJdLHtsYWJlbDogXCJJbmNsdWRlIG9yaWdpbmFsIGRhdGEgaW4gY2hhcnQ/XCJ9KVxuXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIERlY2lkZSB3aGljaCBjaGFydCB0byBkcmF3IGJhc2VkIG9uIGlucHV0LiBUaGVyZSBhcmUgdHdvIGdyYXBoIHR5cGVzLCBhIHN0YW5kYXJkIHNpbXBsZSBjb250aW51b3VzIGxpbmUgcGxvdCBhbmQgYSBwb2xhciBwbG90IG9mIHdpbmQgc3BlZWQgYW5kIGRpcmVjdGlvbi4gQWxzbyBwcm92aWRlIGFuIG9wdGlvbiB0byB0cnkgdGhlIGZhbmN5IEQzIHBsb3RcbmNoYXJ0ID0ge1xuICByZXBsYXk7XG5cbiAgaWYobWVhc3VyZV90eXBlID09IFwiV2luZFwiKXtcblxuICAgIHJldHVybiB3aW5kX2dyYXBoKHBsb3REYXRhKVxuICAgIFxuICB9IGVsc2Uge1xuXG4gICAgaWYoZmFuY3kuaW5jbHVkZXMoXCJZZXNcIikpe1xuICAgICAgXG4gICAgICByZXR1cm4gZHJhd2NoYXJ0KHBsb3REYXRhKVxuICAgICAgXG4gICAgfWVsc2V7XG4gICAgICBcbiAgICAgIHJldHVybiBzaW1wbGVfZ3JhcGgocGxvdERhdGEsIG1lYXN1cmVfdHlwZSwgbWVhc3VyZV91bml0KVxuICAgICAgXG4gICAgfVxuICAgIFxuICB9XG5cbn1cblxuXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgcmVwbGF5ID0gSW5wdXRzLmJ1dHRvbihcIlJlcGxheVwiKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiSW5wdXRzLnRhYmxlKHBsb3REYXRhKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiSW5wdXRzLnRhYmxlKG1lYXN1cmVzKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG5pbXBvcnQgeyBhcSwgb3AgfSBmcm9tICdAdXdkYXRhL2FycXVlcm8nXG5kMyA9IHJlcXVpcmUoXCJkM0A3XCIpXG5wYXJzZXIgPSBkMy50aW1lUGFyc2UoXCIlWS0lbS0lZCAlSDolTTolUyVaXCIpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gUmV0dXJuIHRoZSBncmFwaGVkIG1lYXN1cmUncyB1bml0IGJhc2VkIG9uIHRoZSB1c2VyJ3Mgc2VsZWN0aW9uIFxubWVhc3VyZV91bml0ID0ge1xuXG4gIGlmKG1lYXN1cmVfdHlwZSA9PT0gXCJSYWluIERlcHRoXCIpe1xuICAgIHJldHVybiBcIm1tXCJcbiAgfWVsc2UgaWYobWVhc3VyZV90eXBlID09PSBcIkFpciBUZW1wZXJhdHVyZVwiKXtcbiAgICByZXR1cm4gXCJDXCJcbiAgfWVsc2UgaWYobWVhc3VyZV90eXBlID09PSBcIkFpciBIdW1pZGl0eVwiKXtcbiAgICByZXR1cm4gXCIlUkhcIlxuICB9ZWxzZSBpZihtZWFzdXJlX3R5cGUgPT09IFwiQmFyb21ldHJpYyBQcmVzc3VyZVwiKXtcbiAgICByZXR1cm4gXCJQYVwiXG4gIH1lbHNlIGlmKG1lYXN1cmVfdHlwZSA9PT0gXCJMaWdodCBJbnRlbnNpdHlcIil7XG4gICAgcmV0dXJuIFwiTHV4XCJcbiAgfWVsc2UgaWYobWVhc3VyZV90eXBlID09PSBcIlJhaW4gSW50ZW5zaXR5XCIpe1xuICAgIHJldHVybiBcIm1tL2hyXCJcbiAgfWVsc2UgaWYobWVhc3VyZV90eXBlID09PSBcIlVWIEluZGV4XCIpe1xuICAgIHJldHVybiBcIlVuaXRsZXNzXCJcbiAgfWVsc2UgaWYobWVhc3VyZV90eXBlID09PSBcIldpbmRcIil7XG4gICAgcmV0dXJuIFwibS9zXCJcbiAgfWVsc2V7XG4gICAgcmV0dXJuIFwiVW5rbm93blwiXG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIEFycXVlcm8gaXMgYW4gb2pzIHBhY2thZ2UgZm9yIGRhdGEgbWFuaXB1bGF0aW9uIHNpbWlsYXIgdG8gZHBseXIuIEkgaW1wb3J0IGl0XG4vLyAgYWJvdmUgYXMgd2VsbCBpbiB0aGUgYGltcG9ydHNgIGNodW5rLiBJIHVzZSBhcnF1ZXJvIChgYXFgKSB0byBjb252ZXJ0IHRoZSBcbi8vICBkYXRhIHJldHVybmVkIGJ5IHRoZSBjbG91ZCBmdW5jdGlvbiBmcm9tIGEgc3RyaW5nIHRvIGEgZGF0ZXRpbWUgb2JqZWN0LlxuLy8gIEkndmUgZGVmaW5lZCB0aGUgZGF0ZSBwYXJzZXIgd2l0aCBgRDNgLCBhbm90aGVyIGBvanNgIHBhY2thZ2UuIEFuIGV4YW1wbGVcbi8vICBvZiB0aGF0IGlzIGhlcmU6IGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzc2NDk5OTI4L3Bhc3NpbmctZGF0ZXMtZnJvbS1yLWNodW5rLXRvLW9qcy1jaHVuay11c2luZy1vanMtZGVmaW5lLWluLXF1YXJ0byAgXG4vLyAgXG4vLyBodHRwczovL3F1YXJ0by5vcmcvZG9jcy9pbnRlcmFjdGl2ZS9vanMvZXhhbXBsZXMvYXJxdWVyby5odG1sXG4gbWVhc3VyZXMgPSB7XG4gYWN0aW9uX3NlbmRxdWVyeTtcbiAgaWYgKG1lYXN1cmVfc2NhbGUgPT09IFwiU2V2ZW4gZGF5c1wiKXtcbiAgICByZXR1cm4oYXdhaXQgZDMuanNvbihcImh0dHBzOi8vdXMtZWFzdDEtd2VhdGhlci1zdGF0aW9uLWVmNmNhLmNsb3VkZnVuY3Rpb25zLm5ldC9odHRwc19tZWFzdXJlXzdkYXlfYXNpc1wiKSlcbiAgfVxuICBlbHNlIGlmIChtZWFzdXJlX3NjYWxlID09PSBcIkZvdXJ0ZWVuIGRheXNcIil7XG4gICAgcmV0dXJuKGF3YWl0IGQzLmpzb24oXCJodHRwczovL3VzLWVhc3QxLXdlYXRoZXItc3RhdGlvbi1lZjZjYS5jbG91ZGZ1bmN0aW9ucy5uZXQvaHR0cHNfbWVhc3VyZV8xNGRheV9hc2lzXCIpKVxuICB9XG4gIGVsc2UgaWYgKG1lYXN1cmVfc2NhbGUgPT09IFwiU2l4dHkgZGF5c1wiKXtcbiAgICByZXR1cm4oYXdhaXQgZDMuanNvbihcImh0dHBzOi8vdXMtZWFzdDEtd2VhdGhlci1zdGF0aW9uLWVmNmNhLmNsb3VkZnVuY3Rpb25zLm5ldC9odHRwc19tZWFzdXJlXzYwZGF5X2FzaXNcIikpXG4gIH1cbiAgZWxzZXtcbiAgICByZXR1cm4oSlNPTi5wYXJzZSgnW3tcImxvY2FsX3RpbWVcIjpcIjEwMDAtMDItMDIgMTE6MTE6MTFcIixcInR5cGVcIjogXCJ0ZXN0XCIsXCJtZWFzdXJlbWVudFZhbHVlXCI6XCI0OVwifV0nKSlcbiAgfVxufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIFRha2UgdGhlIGZ1bGwgZGF0YXNldCBhbmQgZmlsdGVyIG91dCB0byBvbmx5IHRoZSBtZWFzdXJlcyB0aGUgdXNlciBzZWxlY3RzLlxuLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0B1d2RhdGEvYW4taWxsdXN0cmF0ZWQtZ3VpZGUtdG8tYXJxdWVyby12ZXJicyNmaWx0ZXJcbi8vIHRoaXMgc2hvdWxkIG1vdmUgdXAgdG8gdGhlIHByZXZpb3VzIGJsb2NrIGJ1dCB3aWxsIHN0YXkgaGVyZSB1bnRpbCB0aGUgY2hhcnRcbi8vICBpcyBmaWd1cmVkIG91dC5cbi8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AdXdkYXRhL2ludHJvZHVjaW5nLWFycXVlcm9cbmZpbHRlcmVkRGF0YSA9IHtcbiAgaWYobWVhc3VyZV90eXBlID09PSBcIldpbmRcIil7XG4gICAgXG4gICAgcmV0dXJuIGZpbHRlcl93aW5kKG1lYXN1cmVzKTtcbiAgICAgIFxuICB9ZWxzZSBpZihtZWFzdXJlX3R5cGUgPT09IFwiUmFpbiBEZXB0aFwiKXtcblxuICAgIHJldHVybiBmaWx0ZXJfY2FsY3VsYXRlX3JhaW5kZXB0aChtZWFzdXJlcylcbiAgICBcbiAgfWVsc2UgaWYobWVhc3VyZV90eXBlID09PSBcIlJhaW4gSW50ZW5zaXR5XCIpe1xuICAgIFxuICAgIHJldHVybiBmaWx0ZXJfZ2VuZXJhbChtZWFzdXJlcywgXCJSYWluIEdhdWdlXCIpXG4gICAgXG4gIH1lbHNle1xuICAgIFxuICAgIHJldHVybiBmaWx0ZXJfZ2VuZXJhbChtZWFzdXJlcywgbWVhc3VyZV90eXBlKSAgICAgICBcbiAgICAgICAgXG4gIH1cbn1cblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBsb3REYXRhID0ge1xuICBpZihtZWFzdXJlX2FnZ3JlZ2F0aW9uID09PSBcIk5vbmVcIil7XG4gICAgXG4gICAgcmV0dXJuIGZpbHRlcmVkRGF0YVxuICAgIFxuICB9ZWxzZSBpZihtZWFzdXJlX2FnZ3JlZ2F0aW9uID09PSBcIjEgRGF5XCIpe1xuICAgIFxuICAgIHJldHVybiBhZ2dyZWdhdGVfZGF0YShmaWx0ZXJlZERhdGEsbWVhc3VyZV90eXBlLDEpXG4gICAgXG4gIH1lbHNlIGlmKG1lYXN1cmVfYWdncmVnYXRpb24gPT09IFwiMTIgSG91cnNcIil7XG4gICAgXG4gICAgcmV0dXJuIGFnZ3JlZ2F0ZV9kYXRhKGZpbHRlcmVkRGF0YSxtZWFzdXJlX3R5cGUsMC41KVxuICAgIFxuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG4vLyBJZiB0aGUgdXNlciB3YW50cyBhbiBhZ2dyZWdhdGlvbiBvZiBhIG1lYXN1cmUgd2hlcmUgc3VtbWF0aW9uIGlzIGFwcHJvcHJpYXRlIChyYWluIGRlcHRoKSwgY29tcGxldGUgdGhhdCBhZ2dyZWdhdGlvbiBvbiB0aGUgZmlsdGVyZWQgZGF0YS5cbmZ1bmN0aW9uIGFnZ3JlZ2F0ZV9kYXRhKGRhdCxtZWFzdXJlLGRheXMpeyBcbiAge1xuICAgIGlmKG1lYXN1cmUgPT09ICdSYWluIERlcHRoJyl7XG4gICAgICByZXR1cm4gZGF0XG4gICAgICAgICAgICAgLmRlcml2ZSh7ICdtZWFzdXJlbWVudFZhbHVlJzogYXEucm9sbGluZyhkID0+IGFxLm9wLnN1bShkLm1lYXN1cmVtZW50VmFsdWUpLCBbLTI0ICogZGF5cywgMF0pIH0pXG4gICAgICBcbiAgICAgICAgICAgfWVsc2V7XG5cbiAgICAgICAgICAgICAgcmV0dXJuIGRhdFxuICAgICAgICAgICAgICAgICAgICAgIC5kZXJpdmUoeyAnbWVhc3VyZW1lbnRWYWx1ZSc6IGFxLnJvbGxpbmcoZCA9PiBhcS5vcC5hdmVyYWdlKGQubWVhc3VyZW1lbnRWYWx1ZSksIFstMjQgKiBkYXlzLCAwXSkgfSlcbiAgICAgIFxuICAgICAgICAgICB9XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBMb3cgZnVuY3Rpb25cbmZ1bmN0aW9uIGZpbHRlcl9nZW5lcmFsKGRhdCwgbWVhc3VyZSl7XG4vLyBUaGlzIGlzIGp1c3QgdGhlIGdlbmVyaWMgZmlsdGVyIGZ1bmN0aW9uIGJhc2VkIG9uIHRoZSBwcm92aWRlZCBtZWFzdXJlX3R5cGVcbiAgcmV0dXJuIGFxLmZyb20oZGF0KVxuICAgICAgICAuZGVyaXZlKHsgdGltZTogYXEuZXNjYXBlKGQgPT4gcGFyc2VyKGQubG9jYWxfdGltZSkpIH0pXG4gICAgICAgIC5wYXJhbXMoe1xuICAgICAgICAgIG06IG1lYXN1cmVcbiAgICAgICAgfSlcbiAgICAgICAgLmZpbHRlcigoZCxwKSA9PiBhcS5vcC5pbmNsdWRlcyhkLnR5cGUsIHAubSkpXG4gICAgICAgIC5vcmRlcmJ5KCAndGltZScpXG4gIFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuLy8gTWlkIGZ1bmN0aW9uXG5mdW5jdGlvbiBmaWx0ZXJfY2FsY3VsYXRlX3JhaW5kZXB0aChkYXQpe1xuXG4gIHJldHVybiBmaWx0ZXJfZ2VuZXJhbChkYXQsXCJSYWluIEdhdWdlXCIpXG4gICAgICAgICAgIC5kZXJpdmUoeyAnbWVhc3VyZW1lbnRWYWx1ZSc6IChkID0+IGQubWVhc3VyZW1lbnRWYWx1ZSAqIDAuMjUpfSkgLy8gZWFjaCBtZWFzdXJlbWVudCBpcyB0YWtlbiAxNSBtaW4gYXBwYXJ0LiBUaGUgbWVhc3VyZSB1bml0IGlzIG1tL2hyIHNvIHdlIGNvbnZlcnQgdG8gbW0gYnkgZGl2aWRpbmcgMTUvNjAgKDE1IG1pbiAvIG1lYXN1cmUgKiAxIGhyIC8gNjAgbWluKSA9IDAuMjUgaHIgLyBtZWFzdXJlLiBUaGVuIG11bHRpcGx5IGJ5IHRoZSBtZWFzdXJlIHRvIGdldCB0aGUgdG90YWwgZGVwdGggKHggbW0vaHIgKiAwLjI1IGhyL21lYXN1cmUgPSB4KjAuMjUgbW0gLyBtZWFzdXJlKVxuICAgICAgICAgICAgIC5vcmRlcmJ5KCd0aW1lJylcbiAgXG59XG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBMb3cgRnVuY3Rpb25cbi8vIFRoaXMgZG9lcyBub3QgcmUtdXNlIHRoZSBnZW5lcmFsIFwiZmlsdGVyX2dlbmVyYWxcIiBmdW5jdGlvbiBiZWNhdXNlIGl0IHJlcXVpcmVzIHR3byBmaWx0ZXIgZWxlbWVudHMuIFxuZnVuY3Rpb24gZmlsdGVyX3dpbmQoZGF0KXtcbiAgXG4gICByZXR1cm4gYXEuZnJvbShkYXQpIC8vIFN0YXJ0IHdpdGggdGhlIGBtZWFzdXJlc2AgdGFibGVcbiAgICAgIC5kZXJpdmUoeyB0aW1lOiBhcS5lc2NhcGUoZCA9PiBwYXJzZXIoZC5sb2NhbF90aW1lKSkgfSkgIC8vIENoYW5nZSB0aGUgdGltZSBzdHJpbmcgdG8gYSB0aW1lIG9iamVjdCBiYXNlZCBvbiB0aGUgcHJvdmlkZWQgZm9ybWF0XG4gICAgICAucGFyYW1zKHsgLy8gbmFtZSBjb2x1bW4gcGFyYW1ldGVycyB0byBiZSB1c2VkIGluIHN1YnNlcXVlbnQgc3RlcHMuXG4gICAgICAgIG06IFwiV2luZCBEaXJlY3Rpb24gU2Vuc29yXCIsXG4gICAgICAgIG46IFwiV2luZCBTcGVlZFwiXG4gICAgICB9KVxuICAgICAgLmZpbHRlcigoZCxwKSA9PiBhcS5vcC5pbmNsdWRlcyhkLnR5cGUsIHAubSkgfHwgYXEub3AuaW5jbHVkZXMoZC50eXBlLCBwLm4pKSAvLyBGaWx0ZXIgdGhlIGRhdGEgcGFzc2VkIChgZGApIGJhc2VkIG9uIHRoZSB0eXBlIGNvbHVtbiBtYXRjaGluZyB0aGUgYFdpbmQgRGlyZWN0aW9uIFNlbnNvcmAgT1IgdGhlIGBXaW5kIFNwZWVkYC5cbiAgICAgIC5vcmRlcmJ5KCAndGltZScpXG4gICAgICAuZ3JvdXBieSgndGltZScpXG4gICAgICAucGl2b3QoJ3R5cGUnLCdtZWFzdXJlbWVudFZhbHVlJykgLy8gRXhwYW5kIHRoZSB1bmlxdWUgb2JzZXJ2YXRpb25zIGluIHRoZSBgbWVhc3VyZW1lbnRWYWx1ZWAgY29sdW1uIGludG8gdGhlaXIgb3duIGNvbHVtbnMsIHNwcmVhZGluZyB0aGUgZGF0YSBmcm9tIGxvbmcgdG8gd2lkZS5cbiAgICAgIC5yZW5hbWUoeyAnV2luZCBEaXJlY3Rpb24gU2Vuc29yJzogJ2RpcmVjdGlvbicsICdXaW5kIFNwZWVkJzogJ3NwZWVkJ30pIC8vIFNpbXBsaWZ5IHRoZSBjb2x1bW4gbmFtaW5nXG4gICAgICAuam9pbl9mdWxsKGFxLnRhYmxlKHsgLy8gQmVjYXVzZSBub3QgYWxsIDM2MCBkZWdyZWVzIHdpbGwgaGF2ZSBvYnNlcnZhdGlvbnMsIEkgY3JlYXRlIGFuIGFycmF5IG9mIDAgLSAzNjAgYW5kIGpvaW4gdGhlIG9yaWdpbmFsIHRvIGl0LCBmaWxsaW5nIGFsbCBtaXNzaW5nIGVsZW1lbnRzIHdpdGggYSAwLlxuICAgICAgICAgIGRpcmVjdGlvbjogQXJyYXkoMzYxKVxuICAgICAgICAgICAgLmZpbGwoKVxuICAgICAgICAgICAgLm1hcCgoZWxlbWVudCwgaW5kZXgpID0+IGluZGV4KSxcbiAgICAgICAgICAgICAgICBzcGVlZDogQXJyYXkoMzYxKVxuICAgICAgICAgICAgICAgIC5maWxsKDApfSkpXG4gICAgICAuZ3JvdXBieSgnZGlyZWN0aW9uJylcbiAgICAgIC5yb2xsdXAoeyAvLyBCeSBkaXJlY3Rpb24gKGRlZ3JlZSksIGNhbGN1bGF0ZSB0aGUgYXZlcmFnZSwgbWluaW11bSwgYW5kIG1heGl1bXVtIHNwZWVkLlxuICAgICAgICAgIGF2ZzogZCA9PiBhcS5vcC5hdmVyYWdlKGQuc3BlZWQpLCBcbiAgICAgICAgICBtaW46IGQgPT4gYXEub3AubWluKGQuc3BlZWQpLCBcbiAgICAgICAgICBtYXg6IGQgPT4gYXEub3AubWF4KGQuc3BlZWQpfSlcbiAgICAgIC5vcmRlcmJ5KCdkaXJlY3Rpb24nKVxuICBcbn1cblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AZDMvcmFkaWFsLWFyZWEtY2hhcnQvMj9pbnRlbnQ9Zm9ya1xuZnVuY3Rpb24gd2luZF9ncmFwaChkYXQpe1xuICBjb25zdCB3aWR0aCA9IDkyODtcbiAgY29uc3QgaGVpZ2h0ID0gd2lkdGg7XG4gIGNvbnN0IG1hcmdpbiA9IDEwO1xuICBjb25zdCBpbm5lclJhZGl1cyA9IHdpZHRoIC8gMTA7XG4gIGNvbnN0IG91dGVyUmFkaXVzID0gd2lkdGggLyAyIC0gbWFyZ2luO1xuICBcbiAgY29uc3QgeCA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFtkMy5taW4oZGF0LCBkID0+IGQuZGlyZWN0aW9uKSxkMy5tYXgoZGF0LCBkID0+IGQuZGlyZWN0aW9uKV0pXG4gICAgLnJhbmdlKFswLCAyICogTWF0aC5QSV0pOyAvL1tkMy5taW4oZGF0LCBkID0+IGQuZGlyZWN0aW9uKSxkMy5tYXgoZGF0LCBkID0+IGQuZGlyZWN0aW9uKV0pO1xuICAgIFxuICBjb25zdCB5ID0gZDMuc2NhbGVSYWRpYWwoKVxuICAgIC5kb21haW4oW2QzLm1pbihkYXQsIGQgPT4gZC5taW4pLCBkMy5tYXgoZGF0LCBkID0+IGQubWF4KV0pXG4gICAgLnJhbmdlKFtpbm5lclJhZGl1cywgb3V0ZXJSYWRpdXNdKTtcbiAgICBcbiAgY29uc3QgbGluZSA9IGQzLmxpbmVSYWRpYWwoKVxuICAgIC5jdXJ2ZShkMy5jdXJ2ZUxpbmVhckNsb3NlZClcbiAgICAuYW5nbGUoZCA9PiB4KGQuZGlyZWN0aW9uKSk7XG4gICAgXG4gIGNvbnN0IGFyZWEgPSBkMy5hcmVhUmFkaWFsKClcbiAgICAuY3VydmUoZDMuY3VydmVMaW5lYXJDbG9zZWQpXG4gICAgLmFuZ2xlKGQgPT4geChkLmRpcmVjdGlvbikpO1xuICAgIFxuICBjb25zdCBzdmcgPSBkMy5jcmVhdGUoXCJzdmdcIilcbiAgICAgIC5hdHRyKFwid2lkdGhcIiwgd2lkdGgpXG4gICAgICAuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpXG4gICAgICAuYXR0cihcInZpZXdCb3hcIiwgWy13aWR0aCAvIDIsIC1oZWlnaHQgLyAyLCB3aWR0aCwgaGVpZ2h0XSlcbiAgICAgIC5hdHRyKFwic3R5bGVcIiwgXCJ3aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOyBmb250OiAxMHB4IHNhbnMtc2VyaWY7XCIpXG4gICAgICAuYXR0cihcInN0cm9rZS1saW5lam9pblwiLCBcInJvdW5kXCIpXG4gICAgICAuYXR0cihcInN0cm9rZS1saW5lY2FwXCIsIFwicm91bmRcIik7XG4gICAgICBcbiAgc3ZnLmFwcGVuZChcInBhdGhcIilcbiAgICAgIC5hdHRyKFwiZmlsbFwiLCBcImxpZ2h0c3RlZWxibHVlXCIpXG4gICAgICAuYXR0cihcImZpbGwtb3BhY2l0eVwiLCAwLjMpXG4gICAgICAuYXR0cihcImRcIiwgYXJlYVxuICAgICAgICAgICAgLmlubmVyUmFkaXVzKGQgPT4geShkLm1pbikpXG4gICAgICAgICAgICAub3V0ZXJSYWRpdXMoZCA9PiB5KGQubWF4KSlcbiAgICAgICAgICAgIChkYXQpKTtcbiAgICAgIFxuICBzdmcuYXBwZW5kKFwicGF0aFwiKVxuICAgICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgICAgLmF0dHIoXCJzdHJva2VcIiwgXCJzdGVlbGJsdWVcIilcbiAgICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDEuNSlcbiAgICAgIC5hdHRyKFwiZFwiLCBsaW5lXG4gICAgICAgICAgLnJhZGl1cyhkID0+IHkoZC5hdmcpKVxuICAgICAgICAgIChkYXQpKTtcbiAgICAgICAgICBcbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAgIC5zZWxlY3RBbGwoKVxuICAgICAgLmRhdGEoeC50aWNrcygpKVxuICAgICAgLmpvaW4oXCJnXCIpXG4gICAgICAgIC5lYWNoKChkLCBpKSA9PiBkLmlkID09IERPTS51aWQoXCJkZWdyZWVcIikpXG4gICAgICAgIC5jYWxsKGcgPT4gZy5hcHBlbmQoXCJwYXRoXCIpXG4gICAgICAgICAgICAuYXR0cihcInN0cm9rZVwiLCBcIiMwMDBcIilcbiAgICAgICAgICAgIC5hdHRyKFwic3Ryb2tlLW9wYWNpdHlcIiwgMC4yKVxuICAgICAgICAgICAgLmF0dHIoXCJkXCIsIGQgPT4gYFxuICAgICAgICAgICAgICBNJHtkMy5wb2ludFJhZGlhbCh4KGQpLCBpbm5lclJhZGl1cyl9XG4gICAgICAgICAgICAgIEwke2QzLnBvaW50UmFkaWFsKHgoZCksIG91dGVyUmFkaXVzKX1cbiAgICAgICAgICAgICAgYCkpXG4gICAgICAgIFxuICBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5zZWxlY3RBbGwoKVxuICAgIC5kYXRhKHkudGlja3MoKS5yZXZlcnNlKCkpXG4gICAgLmpvaW4oXCJnXCIpXG4gICAgICAuY2FsbChnID0+IGcuYXBwZW5kKFwiY2lyY2xlXCIpXG4gICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgICAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwiY3VycmVudENvbG9yXCIpXG4gICAgICAgICAgLmF0dHIoXCJzdHJva2Utb3BhY2l0eVwiLCAwLjIpXG4gICAgICAgICAgLmF0dHIoXCJyXCIsIHkpKVxuICAgICAgLmNhbGwoZyA9PiBnLmFwcGVuZChcInRleHRcIilcbiAgICAgICAgICAuYXR0cihcInlcIiwgZCA9PiAteShkKSlcbiAgICAgICAgICAuYXR0cihcImR5XCIsIFwiMC4zNWVtXCIpXG4gICAgICAgICAgLmF0dHIoXCJzdHJva2VcIiwgXCIjZmZmXCIpXG4gICAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgNSlcbiAgICAgICAgIC5hdHRyKFwiZmlsbFwiLCBcImN1cnJlbnRDb2xvclwiKVxuICAgICAgICAgIC5hdHRyKFwicGFpbnQtb3JkZXJcIiwgXCJzdHJva2VcIilcbiAgICAgICAgICAudGV4dCgoeCwgaSkgPT4gYCR7eC50b0ZpeGVkKDIpfSR7aSA/IFwiXCI6IFwiIG0vc1wifWApXG4gICAgICAuY2xvbmUodHJ1ZSlcbiAgICAgICAgLmF0dHIoXCJ5XCIsIGQgPT4geShkKSkpO1xuICBcbiByZXR1cm4gc3ZnLm5vZGUoKTtcbn1cblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIHNpbXBsZV9ncmFwaChkYXQsbWVhc3VyZSxtZWFzdXJlX3VuaXQpe1xuICBcbnJldHVybiBQbG90LnBsb3Qoe1xuICAgICAgICAgdGl0bGU6IG1lYXN1cmUgKyBcIiBNZWFzdXJlbWVudCBPdmVyIFRpbWVcIixcbiAgICAgICAgIG1hcmdpblRvcDogMjAsXG4gICAgICAgICBtYXJnaW5SaWdodDogMjAsXG4gICAgICAgICBtYXJnaW5Cb3R0b206IDMwLFxuICAgICAgICAgbWFyZ2luTGVmdDogNDAsXG4gICAgICAgICB5OiB7bGFiZWw6IG1lYXN1cmVfdW5pdH0sXG4gICAgICAgICB4OiB7Z3JpZDogdHJ1ZSxcbiAgICAgICAgICAgIGxhYmVsOiBcIkRhdGVcIn0sXG4gICAgICAgICBtYXJrczogW1xuICAgICAgICAgICBQbG90LmxpbmVZKGRhdCwge3g6IFwidGltZVwiLCB5OiBcIm1lYXN1cmVtZW50VmFsdWVcIiwgc3Ryb2tlOiBcImJsdWVcIiwgY2xpcDogXCJmcmFtZVwiLHRpcDogdHJ1ZX0pLFxuICAgICAgICAgICBQbG90LmFyZWFZKGRhdCwge3g6IFwidGltZVwiLCB5OiBcIm1lYXN1cmVtZW50VmFsdWVcIiwgZmlsbE9wYWNpdHk6IDAuMn0pLFxuICAgICAgICAgICBQbG90LmNyb3NzaGFpcihkYXQsIHt4OiBcInRpbWVcIiwgeTogXCJtZWFzdXJlbWVudFZhbHVlXCJ9KSxcbiAgICAgICAgICAgUGxvdC5mcmFtZSgpXG4gICAgICAgICBdXG4gICAgICAgfSlcbiAgXG59XG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJsZW5ndGggPSAocGF0aCkgPT4gZDMuY3JlYXRlKFwic3ZnOnBhdGhcIikuYXR0cihcImRcIiwgcGF0aCkubm9kZSgpLmdldFRvdGFsTGVuZ3RoKCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0BkMy9jb25uZWN0ZWQtc2NhdHRlcnBsb3QvMj9pbnRlbnQ9Zm9ya1xuLy98IGVjaG86IGZhbHNlXG5mdW5jdGlvbiBkcmF3Y2hhcnQoZGF0LCBkYXQyKXtcblxuICBjb25zdCB3aWR0aCA9IDkyODtcbiAgY29uc3QgaGVpZ2h0ID0gNzIwO1xuICBjb25zdCBtYXJnaW5Ub3AgPSAyMDtcbiAgY29uc3QgbWFyZ2luUmlnaHQgPSAzMDtcbiAgY29uc3QgbWFyZ2luQm90dG9tID0gMzA7XG4gIGNvbnN0IG1hcmdpbkxlZnQgPSA0MDtcbiAgXG4gIC8vIERlY2xhcmUgdGhlIHBvc2l0aW9uYWwgZW5jb2RpbmdzLlxuICBjb25zdCB4ID0gZDMuc2NhbGVUaW1lKClcbiAgICAgIC5kb21haW4oZDMuZXh0ZW50KGRhdCwgZCA9PiBkLnRpbWUpKVxuICAgICAgLnJhbmdlKFttYXJnaW5MZWZ0LCB3aWR0aCAtIG1hcmdpblJpZ2h0XSk7XG4gICAgICBcbiAgY29uc3QgeSA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAgIC5kb21haW4oZDMuZXh0ZW50KGRhdCwgZCA9PiBkLm1lYXN1cmVtZW50VmFsdWUpKS5uaWNlKClcbiAgICAgIC5yYW5nZShbaGVpZ2h0IC0gbWFyZ2luQm90dG9tLCBtYXJnaW5Ub3BdKTtcbiAgICAgIFxuICBjb25zdCBsaW5lID0gZDMubGluZSgpXG4gICAgICAuY3VydmUoZDMuY3VydmVDYXRtdWxsUm9tKVxuICAgICAgLngoZCA9PiB4KGQudGltZSkpXG4gICAgICAueShkID0+IHkoZC5tZWFzdXJlbWVudFZhbHVlKSk7XG4gICAgICBcbiAgY29uc3Qgc3ZnID0gZDMuY3JlYXRlKFwic3ZnXCIpXG4gICAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoKVxuICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgaGVpZ2h0KVxuICAgICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCwgaGVpZ2h0XSlcbiAgICAgIC5hdHRyKFwic3R5bGVcIiwgXCJtYXgtd2lkdGg6IDEwMCU7IGhlaWdodDogYXV0bztcIik7XG4gICAgICBcbiAgY29uc3QgbCA9IGxlbmd0aChsaW5lKGRhdCkpO1xuICBcbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoMCwke2hlaWdodCAtIG1hcmdpbkJvdHRvbX0pYClcbiAgICAgIC5jYWxsKGQzLmF4aXNCb3R0b20oeCkudGlja3MoZDMudGltZURheSkpXG4gICAgICAuY2FsbChnID0+IGcuc2VsZWN0KFwiLmRvbWFpblwiKS5yZW1vdmUoKSlcbiAgICAgIC5jYWxsKGcgPT4gZy5zZWxlY3RBbGwoXCIudGljayBsaW5lXCIpLmNsb25lKClcbiAgICAgICAgICAuYXR0cihcInkyXCIsIC1oZWlnaHQpXG4gICAgICAgICAgLmF0dHIoXCJzdHJva2Utb3BhY2l0eVwiLCAwLjEpKVxuICAgICAgLmNhbGwoZyA9PiBnLmFwcGVuZChcInRleHRcIilcbiAgICAgICAgICAuYXR0cihcInhcIiwgd2lkdGggLSA0KVxuICAgICAgICAgIC5hdHRyKFwieVwiLCAtNClcbiAgICAgICAgICAuYXR0cihcImZvbnQtd2VpZ2h0XCIsIFwiYm9sZFwiKVxuICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJlbmRcIilcbiAgICAgICAgICAuYXR0cihcImZpbGxcIiwgXCJjdXJyZW50Q29sb3JcIilcbiAgICAgICAgICAudGV4dChcIkRhdGVcIikpO1xuICAgICAgICAgIFxuICBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbkxlZnR9LDApYClcbiAgICAgIC5jYWxsKGQzLmF4aXNMZWZ0KHkpLnRpY2tzKG51bGwsIFwiLjJmXCIpKVxuICAgICAgLmNhbGwoZyA9PiBnLnNlbGVjdChcIi5kb21haW5cIikucmVtb3ZlKCkpXG4gICAgICAuY2FsbChnID0+IGcuc2VsZWN0QWxsKFwiLnRpY2sgbGluZVwiKS5jbG9uZSgpXG4gICAgICAgICAgLmF0dHIoXCJ4MlwiLCAtd2lkdGgpXG4gICAgICAgICAgLmF0dHIoXCJzdHJva2Utb3BhY2l0eVwiLCAwLjEpKVxuICAgICAgLmNhbGwoZyA9PiBnLmFwcGVuZChcInRleHRcIilcbiAgICAgICAgICAuYXR0cihcInhcIiwgMTApXG4gICAgICAgICAgLmF0dHIoXCJ5XCIsIGhlaWdodCAtIDQpXG4gICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcInN0YXJ0XCIpXG4gICAgICAgICAgLmF0dHIoXCJmb250LXdlaWdodFwiLCBcImJvbGRcIilcbiAgICAgICAgICAudGV4dChcIk1lYXN1cmVcIikpO1xuICAgICAgICAgIFxuICBzdmcuYXBwZW5kKFwicGF0aFwiKVxuICAgICAgLmRhdHVtKGRhdClcbiAgICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwiYmx1ZVwiKVxuICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMi41KVxuICAgICAgLmF0dHIoXCJzdHJva2UtbGluZWpvaW5cIiwgXCJyb3VuZFwiKVxuICAgICAgLmF0dHIoXCJzdHJva2UtbGluZWNhcFwiLCBcInJvdW5kXCIpXG4gICAgICAuYXR0cihcInN0cm9rZS1kYXNoYXJyYXlcIiwgYDAsJHtsfWApXG4gICAgICAuYXR0cihcImRcIiwgbGluZSlcbiAgICAudHJhbnNpdGlvbigpXG4gICAgICAuZHVyYXRpb24oNTAwMClcbiAgICAgIC5lYXNlKGQzLmVhc2VMaW5lYXIpXG4gICAgICAuYXR0cihcInN0cm9rZS1kYXNoYXJyYXlcIiwgYCR7bH0sJHtsfWApO1xuICAgICAgXG4gICAgICBpZiAodHlwZW9mIGRhdDIgIT09ICd1bmRlZmluZWQnKXtcbiAgICAgIFxuICAgICAgICAgc3ZnLmFwcGVuZChcInBhdGhcIilcbiAgICAgICAgICAgLmRhdHVtKGRhdDIpXG4gICAgICAgICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAgICAgICAgLmF0dHIoXCJzdHJva2VcIiwgXCJyZWRcIilcbiAgICAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMi41KVxuICAgICAgICAgICAuYXR0cihcInN0cm9rZS1saW5lam9pblwiLCBcInJvdW5kXCIpXG4gICAgICAgICAgIC5hdHRyKFwic3Ryb2tlLWxpbmVjYXBcIiwgXCJyb3VuZFwiKVxuICAgICAgICAgICAuYXR0cihcInN0cm9rZS1kYXNoYXJyYXlcIiwgYDAsJHtsfWApXG4gICAgICAgICAgIC5hdHRyKFwiZFwiLCBsaW5lKVxuICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAuZHVyYXRpb24oNTAwMClcbiAgICAgICAgICAgLmVhc2UoZDMuZWFzZUxpbmVhcilcbiAgICAgICAgICAgLmF0dHIoXCJzdHJva2UtZGFzaGFycmF5XCIsIGAke2x9LCR7bH1gKTtcbiAgICAgIH07XG5cbiAgcmV0dXJuIHN2Zy5ub2RlKCk7XG5cbn1cblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdtZWFzdXJlX3NjYWxlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2FjdGlvbl9zZW5kcXVlcnknKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnbWVhc3VyZV90eXBlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ21lYXN1cmVfYWdncmVnYXRpb24nKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnZmFuY3knKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncmVwbGF5JykifV19
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../..";
window._ojs.paths.runtimeToRoot = "../../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>